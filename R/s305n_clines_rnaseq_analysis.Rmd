---
title: "S305N Cell Lines RNAseq Analysis"
author:
  - name: "Emir Turkes and Eliona Tsefou, UK DRI at UCL"
date: '`r strftime(Sys.time(), format = "%B %d, %Y")`'
bibliography: "../s305n-clines-rnaseq.bib"
biblio-style: apalike
link-citations: true
output:
  html_document:
    code_folding: hide
    number_sections: true
    theme: lumen
    highlight: haddock
    toc: true
    toc_depth: 2
    toc_float:
      collapsed: false
      smooth_scroll: false
knit: (function(inputFile, encoding) {
  rmarkdown::render(
    inputFile, encoding = encoding, output_file = file.path("..", "results", "s305n_clines_rnaseq_analysis.html")
  )})
---

<style type="text/css">
body {font-size: 16px;}
h1.title {font-size: 35px;}
h1 {font-size: 24px;}
h2 {font-size: 22px;}
.toc-content {padding-left: 0px; padding-right: 0px;}
div.tocify {width: 100%;}
.tocify-subheader .tocify-item {font-size: 0.95em; padding-left: 25px; text-indent: 0;}
div.main-container {max-width: none; width: 100%;}
</style>

*This file is a part of [s305n-clines-rnaseq](https://github.com/eturkes/s305n-clines-rnaseq).*

The table of contents in the top left is clickable and can be used to quickly navigate the document.
To toggle the visibility of code, use the `CODE` toggles at the top right of chunks.
The toggle at the start of the document controls the visibility of all chunks.

This analysis is a comparison of bulk RNAseq data from human iPSC neuronal cell lines obtained from Synthego and NCRAD with the MAPT S305 mutation.
We also compare bulk RNAseq data from @bowles_development_2024, which used the same NCRAD lines.

```{r}
# Copyright (c) Emir Turkes, Eliona Tsefou, UK DRI at UCL
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# ---- LLVM Exceptions to the Apache 2.0 License ----
#
# As an exception, if, as a result of your compiling your source code, portions
# of this Software are embedded into an Object form of such source code, you
# may redistribute such embedded portions in such Object form without complying
# with the conditions of Sections 4(a), 4(b) and 4(d) of the License.
#
# In addition, if you combine or link compiled forms of this Software with
# software that is licensed under the GPLv2 ("Combined Software") and if a
# court of competent jurisdiction determines that the patent provision (Section
# 3), the indemnity provision (Section 9) or other Section of the License
# conflicts with the conditions of the GPLv2, you may retroactively and
# prospectively choose to deem waived or otherwise exclude such Section(s) of
# the License, but only in their entirety and only with respect to the Combined
# Software.

# Load packages.
# --------------
library(conflicted) # Ensure packages do not have namespace conflicts.
# --------------

# Add paths.
# ----------
data_dir <- file.path("..", "data")
cache_dir <- file.path("..", "cache")
if (!dir.exists(cache_dir)) {
  dir.create(cache_dir, recursive = TRUE)
}
# ----------
```

# Prep Data

```{r}
synthego <- read.csv(file.path(data_dir, "Final counts_RNAseq_Synthego.txt"), sep = "\t", row.names = 1)
ncard <- read.csv(file.path(data_dir, "gene_count_NCARD.txt"), sep = "\t", row.names = 1)

# When stripping bowles data to plain ENSEMBL IDs there are duplicates.
# We collapse these duplicates to the mean of each set per sample.
# Since this process is somewhat slow, we cache the cleaned object.
# ---------------------------------------------------------------------
cache <- file.path(cache_dir, "bowles.qs")
if (file.exists(cache)) {
  bowles <- qs::qread(cache)
} else {
  bowles <- read.csv(file.path(data_dir, "GSE260517_star_gene.txt"), sep = "\t")
  bowles$gid <- sub("\\..*", "", bowles$gid)
  bowles <- aggregate(. ~ gid, data = bowles, FUN = mean)
  rownames(bowles) <- bowles$gid
  bowles$gid <- NULL
  qs::qsave(bowles, file = cache)
}
# ---------------------------------------------------------------------
```

# References

This is the concluding section of the document, where we output the `sessionInfo`, and create a bibliography for works cited.

```{r}
sessionInfo()
```
